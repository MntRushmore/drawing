<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>HandPaint â€” Artistic Hand Drawing</title>
<style>
  body { margin: 0; background: #111; color: white; font-family: sans-serif; overflow: hidden; }
  #controls { position: fixed; top: 10px; left: 10px; z-index: 10; }
  button { margin: 2px; padding: 6px 10px; border: none; border-radius: 6px; cursor: pointer; }
  canvas { display: block; }
</style>
</head>
<body>
<div id="controls">
  <button id="startBtn">Start Camera</button>
  <button id="clearBtn">Clear</button>
  <button id="saveBtn">Save</button>
</div>
<video id="video" autoplay playsinline style="display:none"></video>
<canvas id="canvas"></canvas>
<script src="https://cdn.jsdelivr.net/npm/@mediapipe/hands/hands.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@mediapipe/drawing_utils/drawing_utils.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.min.js"></script>
<script>
const video = document.getElementById('video');
const canvas = document.getElementById('canvas');
const ctx = canvas.getContext('2d');
let drawing = false;
let pinchActive = false;
let prevX = null, prevY = null;

canvas.width = window.innerWidth;
canvas.height = window.innerHeight;

function clearCanvas() {
  ctx.clearRect(0, 0, canvas.width, canvas.height);
}

document.getElementById('clearBtn').onclick = clearCanvas;
document.getElementById('saveBtn').onclick = () => {
  const link = document.createElement('a');
  link.download = 'handpaint.png';
  link.href = canvas.toDataURL();
  link.click();
};

function onResults(results) {
  ctx.drawImage(results.image, 0, 0, canvas.width, canvas.height);
  if (results.multiHandLandmarks && results.multiHandLandmarks.length > 0) {
    const landmarks = results.multiHandLandmarks[0];
    drawConnectors(ctx, landmarks, HAND_CONNECTIONS, {color: 'rgba(255,255,255,0.3)', lineWidth: 1});
    drawLandmarks(ctx, landmarks, {color: 'rgba(255,255,255,0.5)', lineWidth: 1});

    const indexTip = landmarks[8];
    const thumbTip = landmarks[4];
    const dx = indexTip.x - thumbTip.x;
    const dy = indexTip.y - thumbTip.y;
    const distance = Math.sqrt(dx * dx + dy * dy);

    if (distance < 0.05 && !pinchActive) {
      drawing = !drawing;
      pinchActive = true;
    } else if (distance >= 0.05) {
      pinchActive = false;
    }

    const x = indexTip.x * canvas.width;
    const y = indexTip.y * canvas.height;
    if (drawing && prevX !== null && prevY !== null) {
      ctx.strokeStyle = `hsl(${(Date.now()/20)%360}, 100%, 70%)`;
      ctx.lineWidth = 5;
      ctx.beginPath();
      ctx.moveTo(prevX, prevY);
      ctx.lineTo(x, y);
      ctx.stroke();
    }
    prevX = x;
    prevY = y;
  }
}

document.getElementById('startBtn').onclick = async () => {
  const hands = new Hands({locateFile: file => `https://cdn.jsdelivr.net/npm/@mediapipe/hands/${file}`});
  hands.setOptions({ maxNumHands: 1, modelComplexity: 1, minDetectionConfidence: 0.7, minTrackingConfidence: 0.7 });
  hands.onResults(onResults);

  const camera = new Camera(video, {
    onFrame: async () => {
      await hands.send({image: video});
    },
    width: 640,
    height: 480
  });
  camera.start();
};
</script>
</body>
</html>
