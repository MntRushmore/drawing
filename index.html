<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>HandPaint â€” Camera Drawing</title>
<style>
  body { margin: 0; background: #111; color: white; font-family: sans-serif; }
  canvas { display: block; margin: 0 auto; background: #000; }
  .controls { position: fixed; top: 10px; left: 10px; z-index: 10; }
  button { margin-right: 5px; padding: 5px 10px; }
</style>
<script src="https://cdn.jsdelivr.net/npm/@mediapipe/hands/hands.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@mediapipe/drawing_utils/drawing_utils.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js"></script>
</head>
<body>
<div class="controls">
  <button id="start">Start Camera</button>
  <button id="clear">Clear</button>
  <button id="save">Save</button>
  <select id="brush">
    <option value="neon">Neon</option>
    <option value="ink">Ink</option>
    <option value="watercolor">Watercolor</option>
    <option value="particles">Particles</option>
  </select>
</div>
<video id="video" style="display:none;" playsinline></video>
<canvas id="output"></canvas>
<script>
const video = document.getElementById('video');
const canvas = document.getElementById('output');
const ctx = canvas.getContext('2d');
canvas.width = window.innerWidth;
canvas.height = window.innerHeight;

let drawing = false;
let prevX = null, prevY = null;
let brushType = 'neon';

function distance(a, b) {
  return Math.hypot(a.x - b.x, a.y - b.y);
}

function drawLine(x1, y1, x2, y2) {
  if (brushType === 'neon') {
    ctx.strokeStyle = `hsl(${Math.random()*360},100%,50%)`;
    ctx.shadowColor = ctx.strokeStyle;
    ctx.shadowBlur = 20;
    ctx.lineWidth = 5;
  } else if (brushType === 'ink') {
    ctx.strokeStyle = 'black';
    ctx.shadowBlur = 0;
    ctx.lineWidth = 3;
  } else if (brushType === 'watercolor') {
    ctx.strokeStyle = `rgba(0,0,255,${Math.random()*0.5})`;
    ctx.lineWidth = 20;
  } else if (brushType === 'particles') {
    for (let i=0;i<5;i++) {
      ctx.fillStyle = `hsl(${Math.random()*360},100%,50%)`;
      ctx.beginPath();
      ctx.arc(x2 + Math.random()*10-5, y2 + Math.random()*10-5, 3, 0, Math.PI*2);
      ctx.fill();
    }
    return;
  }
  ctx.beginPath();
  ctx.moveTo(x1, y1);
  ctx.lineTo(x2, y2);
  ctx.stroke();
}

const hands = new Hands({locateFile: file => `https://cdn.jsdelivr.net/npm/@mediapipe/hands/${file}`});
hands.setOptions({
  maxNumHands: 1,
  modelComplexity: 1,
  minDetectionConfidence: 0.7,
  minTrackingConfidence: 0.5
});

hands.onResults(results => {
  ctx.drawImage(results.image, 0, 0, canvas.width, canvas.height);
  if (results.multiHandLandmarks && results.multiHandLandmarks.length > 0) {
    const landmarks = results.multiHandLandmarks[0];
    const indexTip = landmarks[8];
    const thumbTip = landmarks[4];
    const pinch = distance(indexTip, thumbTip) < 0.05;
    const x = indexTip.x * canvas.width;
    const y = indexTip.y * canvas.height;
    if (pinch) {
      if (!drawing) {
        drawing = true;
        prevX = x; prevY = y;
      } else {
        drawLine(prevX, prevY, x, y);
        prevX = x; prevY = y;
      }
    } else {
      drawing = false;
    }
  }
});

document.getElementById('start').onclick = async () => {
  const camera = new Camera(video, {
    onFrame: async () => { await hands.send({image: video}); },
    width: 640,
    height: 480
  });
  camera.start();
};

document.getElementById('clear').onclick = () => {
  ctx.clearRect(0,0,canvas.width,canvas.height);
};

document.getElementById('save').onclick = () => {
  const link = document.createElement('a');
  link.download = 'art.png';
  link.href = canvas.toDataURL();
  link.click();
};

document.getElementById('brush').onchange = e => {
  brushType = e.target.value;
};
</script>
</body>
</html>
